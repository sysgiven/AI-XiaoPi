# æŠ–éŸ³å¼¹å¹•é‡‡é›†é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•é…ç½® xiaozhi-esp32-server ä½¿ç”¨ DouyinBarrageGrab è·å–çœŸå®çš„æŠ–éŸ³ç›´æ’­é—´å¼¹å¹•ã€‚

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
- [å®‰è£…æ­¥éª¤](#å®‰è£…æ­¥éª¤)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [å¯åŠ¨æµç¨‹](#å¯åŠ¨æµç¨‹)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [è¿›é˜¶é…ç½®](#è¿›é˜¶é…ç½®)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æŠ–éŸ³ç›´æ’­å¼¹å¹•è·å–ç³»ç»Ÿ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æµè§ˆå™¨æ‰“å¼€   â”‚      â”‚  DouyinBarrage   â”‚      â”‚  xiaozhi-esp32   â”‚
â”‚  æŠ–éŸ³ç›´æ’­é—´   â”‚â”€â”€â”€â”€â”€>â”‚  Grab ä»£ç†æœåŠ¡å™¨  â”‚â”€â”€â”€â”€â”€>â”‚  -server æœåŠ¡    â”‚
â”‚              â”‚ WSS  â”‚                  â”‚ WS   â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                          â”‚
                             â”‚                          â”‚
                             v                          v
                      ç³»ç»Ÿä»£ç†æ‹¦æˆª                  å¼¹å¹•å¤„ç†
                      è§£æ Protobuf                  LLMç”Ÿæˆå›å¤
                      æä¾› WS æœåŠ¡                   TTSè¯­éŸ³åˆæˆ
                      (ç«¯å£ 8888)                    å¹¿æ’­åˆ°è®¾å¤‡
```

**å·¥ä½œåŸç†ï¼š**
1. DouyinBarrageGrab å¯åŠ¨ç³»ç»Ÿä»£ç†ï¼Œæ‹¦æˆªæµè§ˆå™¨çš„ WebSocket è¿æ¥
2. è§£ææŠ–éŸ³çš„ Protobuf åè®®æ¶ˆæ¯ï¼Œæå–å¼¹å¹•æ•°æ®
3. é€šè¿‡ WebSocket æœåŠ¡å™¨ (ws://127.0.0.1:8888) å¹¿æ’­å¼¹å¹•
4. xiaozhi-server ä½œä¸ºå®¢æˆ·ç«¯è¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨æ¥æ”¶å¼¹å¹•
5. å¤„ç†å¼¹å¹•å¹¶ç”Ÿæˆ AI å›å¤

---

## ğŸ“¦ å‡†å¤‡å·¥ä½œ

### 1. ä¸‹è½½ DouyinBarrageGrab

**Giteeï¼ˆæ¨èï¼Œå›½å†…è®¿é—®å¿«ï¼‰ï¼š**
- é¡¹ç›®åœ°å€ï¼šhttps://gitee.com/haodong108/dy-barrage-grab
- å‘è¡Œç‰ˆä¸‹è½½ï¼šhttps://gitee.com/haodong108/dy-barrage-grab/releases

**GitHubï¼ˆå¤‡ç”¨ï¼‰ï¼š**
- é¡¹ç›®åœ°å€ï¼šhttps://github.com/haodong108/dy-barrage-grab

> âš ï¸ **æ³¨æ„**ï¼šè¯·ä¸‹è½½ Releases ä¸­çš„å‘è¡Œç‰ˆï¼ˆexeæ–‡ä»¶ï¼‰ï¼Œä¸è¦ä¸‹è½½æºç åŒ…ï¼

### 2. ç³»ç»Ÿè¦æ±‚

| é¡¹ç›® | è¦æ±‚ |
|-----|------|
| æ“ä½œç³»ç»Ÿ | Windows 7/8/10/11 |
| æƒé™ | **ç®¡ç†å‘˜æƒé™**ï¼ˆå¿…é¡»ï¼‰ |
| æµè§ˆå™¨ | Chrome / Edge / Firefox ç­‰ |
| Python | 3.10+ (xiaozhi-server éœ€è¦) |
| ç½‘ç»œ | èƒ½è®¿é—®æŠ–éŸ³ç›´æ’­ |

---

## ğŸš€ å®‰è£…æ­¥éª¤

### æ­¥éª¤ 1: å®‰è£… DouyinBarrageGrab

1. **ä¸‹è½½å¹¶è§£å‹**
   ```
   ä¸‹è½½ WssBarrageService_vX.X.X.zip
   è§£å‹åˆ°ä»»æ„ç›®å½•ï¼ˆå¦‚ C:\DouyinBarrageGrab\ï¼‰
   ```

2. **é¦–æ¬¡è¿è¡Œï¼ˆå®‰è£…è¯ä¹¦ï¼‰**
   - å³é”® `WssBarrageService.exe`
   - é€‰æ‹©"ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ"
   - é¦–æ¬¡è¿è¡Œä¼šæç¤ºå®‰è£…è‡ªç­¾åè¯ä¹¦ï¼Œç‚¹å‡»"æ˜¯"

3. **éªŒè¯è¿è¡Œ**
   - ç¨‹åºå¯åŠ¨åä¼šæ˜¾ç¤ºæ§åˆ¶å°çª—å£
   - æ§åˆ¶å°æ ‡é¢˜æ˜¾ç¤º WebSocket è¿æ¥åœ°å€ï¼ˆé»˜è®¤ ws://127.0.0.1:8888ï¼‰

### æ­¥éª¤ 2: é…ç½® xiaozhi-server

ç¼–è¾‘ `danmaku_config.yaml` æ–‡ä»¶ï¼š

```yaml
danmaku:
  # è®¾ç½®ä¸ºçœŸå®ç›´æ’­é—´IDï¼ˆå¯é€‰ï¼Œä»£ç†æ¨¡å¼ä¸‹è‡ªåŠ¨è·å–ï¼‰
  room_id: "your_room_id"

  # å…³é—­æ¨¡æ‹Ÿæ¨¡å¼
  use_mock: false

  # å¼€å¯ä»£ç†æ¨¡å¼
  use_proxy: true

  # DouyinBarrageGrab åœ°å€ï¼ˆé»˜è®¤æ— éœ€ä¿®æ”¹ï¼‰
  proxy_ws_url: "ws://127.0.0.1:8888"
```

### æ­¥éª¤ 3: é…ç½® LLM å’Œ TTS

ç¡®ä¿ `danmaku_config.yaml` ä¸­é…ç½®äº†æœ‰æ•ˆçš„ API Keyï¼š

```yaml
# LLMé…ç½®
LLM:
  ChatGLMLLM:
    type: openai
    model_name: glm-4-flash
    url: https://open.bigmodel.cn/api/paas/v4/
    api_key: "ä½ çš„æ™ºè°±APIå¯†é’¥"  # åœ¨ https://bigmodel.cn è·å–

# TTSé…ç½®ï¼ˆEdgeTTS å…è´¹ï¼Œæ— éœ€ API Keyï¼‰
TTS:
  EdgeTTS:
    type: edge
    voice: zh-CN-XiaoxiaoNeural
    output_dir: tmp/
```

---

## ğŸ¯ å¯åŠ¨æµç¨‹

### å®Œæ•´å¯åŠ¨é¡ºåºï¼ˆé‡è¦ï¼ï¼‰

```
1. å¯åŠ¨ DouyinBarrageGrab
   â†“
2. æ‰“å¼€æµè§ˆå™¨è¿›å…¥æŠ–éŸ³ç›´æ’­é—´
   â†“
3. å¯åŠ¨ xiaozhi-server
   â†“
4. è§‚å¯Ÿå¼¹å¹•æ˜¯å¦æ­£å¸¸æ¥æ”¶
```

### è¯¦ç»†æ­¥éª¤

**1. å¯åŠ¨ DouyinBarrageGrab**

```bash
# ç®¡ç†å‘˜èº«ä»½è¿è¡Œ
WssBarrageService.exe
```

çœ‹åˆ°ä»¥ä¸‹æç¤ºè¡¨ç¤ºæˆåŠŸï¼š
```
å¯åŠ¨æˆåŠŸ
WebSocket Server: ws://127.0.0.1:8888
ç³»ç»Ÿä»£ç†å·²å¼€å¯
```

**2. æ‰“å¼€æµè§ˆå™¨è¿›å…¥ç›´æ’­é—´**

```
1. æ‰“å¼€ Chrome/Edge æµè§ˆå™¨
2. è®¿é—®æŠ–éŸ³ç›´æ’­é—´
   - ç½‘é¡µç‰ˆï¼šhttps://live.douyin.com/æˆ¿é—´å·
3. è§‚å¯Ÿ DouyinBarrageGrab æ§åˆ¶å°æ˜¯å¦æœ‰å¼¹å¹•æ»šåŠ¨
```

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœæ²¡æœ‰å¼¹å¹•æ»šåŠ¨ï¼Œè¯·å‚è€ƒ[æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)éƒ¨åˆ†

**3. å¯åŠ¨ xiaozhi-server**

**Linux/macOS:**
```bash
cd xiaozhi-esp32-server/main/xiaozhi-server
chmod +x start_danmaku.sh
./start_danmaku.sh
```

**Windows:**
```bash
cd xiaozhi-esp32-server\main\xiaozhi-server
start_danmaku.bat
```

**æˆ–ç›´æ¥è¿è¡Œï¼š**
```bash
python danmaku_app.py
```

**4. éªŒè¯è¿æ¥**

xiaozhi-server å¯åŠ¨ååº”æ˜¾ç¤ºï¼š
```
âœ… æˆåŠŸè¿æ¥åˆ° DouyinBarrageGrab æœåŠ¡å™¨
è¯·ç¡®ä¿ï¼š
1. DouyinBarrageGrab ç¨‹åºæ­£åœ¨è¿è¡Œ
2. æµè§ˆå™¨å·²æ‰“å¼€æŠ–éŸ³ç›´æ’­é—´

ğŸ’¬ [ä¸»æ’­æ˜µç§°] [ç”·] ç”¨æˆ·A: ä½ å¥½
ğŸ’¬ [ä¸»æ’­æ˜µç§°] [å¥³] ç”¨æˆ·B: 666
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### danmaku_config.yaml å®Œæ•´é…ç½®

```yaml
danmaku:
  # ---------- åŸºç¡€é…ç½® ----------
  room_id: "608120546494"          # ç›´æ’­é—´IDï¼ˆä»£ç†æ¨¡å¼å¯ä¸å¡«ï¼‰

  # ---------- å·¥ä½œæ¨¡å¼é€‰æ‹©ï¼ˆä¸‰é€‰ä¸€ï¼‰----------
  # æ¨¡å¼1: æ¨¡æ‹Ÿæ¨¡å¼ - å¼€å‘æµ‹è¯•ç”¨
  use_mock: false                  # true=æ¨¡æ‹Ÿå¼¹å¹•ï¼Œfalse=çœŸå®å¼¹å¹•

  # æ¨¡å¼2: ä»£ç†æ¨¡å¼ - ç”Ÿäº§ç¯å¢ƒæ¨è
  use_proxy: true                  # true=ä½¿ç”¨DouyinBarrageGrab
  proxy_ws_url: "ws://127.0.0.1:8888"  # DouyinBarrageGrabåœ°å€

  # æ¨¡å¼3: ç›´è¿æ¨¡å¼ - éœ€è¦è‡ªè¡Œå®ç°æŠ–éŸ³åè®®
  # use_mock: false, use_proxy: false

  # ---------- WebSocketæœåŠ¡å™¨é…ç½® ----------
  ws_host: 0.0.0.0                # ç›‘å¬åœ°å€
  ws_port: 8001                   # ç›‘å¬ç«¯å£
```

### DouyinBarrageGrab é…ç½®

é…ç½®æ–‡ä»¶ï¼š`WssBarrageService.exe.config`

```xml
<appSettings>
  <!-- WebSocketç›‘å¬ç«¯å£ -->
  <add key="wsListenPort" value="8888" />

  <!-- ç³»ç»Ÿä»£ç†ç«¯å£ -->
  <add key="proxyPort" value="8827" />

  <!-- æ˜¯å¦å¯ç”¨ç³»ç»Ÿä»£ç† -->
  <add key="sysProxy" value="true" />

  <!-- åœ¨æ§åˆ¶å°è¾“å‡ºå¼¹å¹• -->
  <add key="printBarrage" value="true" />

  <!-- è¦æ¨é€çš„å¼¹å¹•æ¶ˆæ¯ç±»å‹ï¼ˆç©ºä»£è¡¨å…¨éƒ¨æ¨é€ï¼‰-->
  <add key="pushFilter" value="" />

  <!-- æ›´å¤šé…ç½®è¯·å‚è€ƒ DouyinBarrageGrab æ–‡æ¡£ -->
</appSettings>
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: DouyinBarrageGrab æ— æ³•å¯åŠ¨

**ç—‡çŠ¶ï¼š** åŒå‡» exe é—ªé€€æˆ–æŠ¥é”™

**è§£å†³æ–¹æ³•ï¼š**
1. âœ… ç¡®è®¤ä»¥**ç®¡ç†å‘˜èº«ä»½è¿è¡Œ**
2. âœ… å…³é—­æ€æ¯’è½¯ä»¶ï¼ˆ360ã€è…¾è®¯ç®¡å®¶ç­‰ï¼‰
3. âœ… å…³é—­ Windows é˜²ç«å¢™
4. âœ… æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š
   ```bash
   netstat -ano | findstr "8888"
   netstat -ano | findstr "8827"
   ```

### é—®é¢˜ 2: DouyinBarrageGrab å¯åŠ¨ä½†æ— å¼¹å¹•

**ç—‡çŠ¶ï¼š** ç¨‹åºè¿è¡Œæ­£å¸¸ï¼Œä½†æ§åˆ¶å°æ— å¼¹å¹•æ»šåŠ¨

**è§£å†³æ–¹æ³•ï¼š**
1. âœ… æ£€æŸ¥ç³»ç»Ÿä»£ç†æ˜¯å¦å¼€å¯ï¼š
   ```
   è®¾ç½® â†’ ç½‘ç»œå’ŒInternet â†’ ä»£ç† â†’ ä½¿ç”¨ä»£ç†æœåŠ¡å™¨
   åº”è¯¥æ˜¾ç¤ºï¼š127.0.0.1:8827
   ```

2. âœ… æ£€æŸ¥æµè§ˆå™¨è¿›ç¨‹åï¼š
   ```xml
   <!-- åœ¨ config æ–‡ä»¶ä¸­æ·»åŠ ä½ çš„æµè§ˆå™¨ -->
   <add key="processFilter" value="chrome,msedge,firefox" />
   ```

3. âœ… ç¡®ä¿å¯åŠ¨é¡ºåºæ­£ç¡®ï¼š
   ```
   å…ˆå¯åŠ¨ DouyinBarrageGrab â†’ å†æ‰“å¼€ç›´æ’­é—´
   ï¼ˆä¸èƒ½å…ˆæ‰“å¼€ç›´æ’­é—´å†å¯åŠ¨ç¨‹åºï¼‰
   ```

4. âœ… åˆ·æ–°ç›´æ’­é—´é¡µé¢

### é—®é¢˜ 3: xiaozhi-server æ— æ³•è¿æ¥åˆ° DouyinBarrageGrab

**ç—‡çŠ¶ï¼š** æ˜¾ç¤º "âŒ è¿æ¥è¢«æ‹’ç»"

**è§£å†³æ–¹æ³•ï¼š**
1. âœ… ç¡®è®¤ DouyinBarrageGrab æ­£åœ¨è¿è¡Œ
2. âœ… æ£€æŸ¥ WebSocket ç«¯å£ï¼ˆé»˜è®¤ 8888ï¼‰ï¼š
   ```bash
   # Windows
   netstat -ano | findstr "8888"

   # Linux
   netstat -tuln | grep 8888
   ```

3. âœ… ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­çš„åœ°å€æ­£ç¡®ï¼š
   ```yaml
   proxy_ws_url: "ws://127.0.0.1:8888"  # æ³¨æ„æ˜¯ ws:// ä¸æ˜¯ wss://
   ```

4. âœ… å°è¯•ä½¿ç”¨åœ¨çº¿å·¥å…·æµ‹è¯•è¿æ¥ï¼š
   - è®¿é—®ï¼šhttp://wstool.jackxiang.com/
   - è¾“å…¥ï¼šws://127.0.0.1:8888
   - ç‚¹å‡»è¿æ¥ï¼ŒæŸ¥çœ‹æ˜¯å¦æˆåŠŸ

### é—®é¢˜ 4: è¿æ¥æˆåŠŸä½†æ”¶ä¸åˆ°å¼¹å¹•

**ç—‡çŠ¶ï¼š** xiaozhi-server æ˜¾ç¤ºå·²è¿æ¥ï¼Œä½†æ²¡æœ‰å¼¹å¹•æ¶ˆæ¯

**è§£å†³æ–¹æ³•ï¼š**
1. âœ… ç¡®è®¤ DouyinBarrageGrab æ§åˆ¶å°æœ‰å¼¹å¹•æ»šåŠ¨
2. âœ… æ£€æŸ¥ DouyinBarrageGrab çš„æ¨é€è¿‡æ»¤é…ç½®ï¼š
   ```xml
   <!-- ç¡®ä¿æ²¡æœ‰è¿‡æ»¤æ‰æ‰€æœ‰æ¶ˆæ¯ -->
   <add key="pushFilter" value="" />
   ```

3. âœ… è§‚å¯Ÿ xiaozhi-server æ—¥å¿—æ–‡ä»¶ï¼š
   ```bash
   tail -f tmp/danmaku_server.log
   ```

### é—®é¢˜ 5: ç¨‹åºå…³é—­åæ— æ³•ä¸Šç½‘

**ç—‡çŠ¶ï¼š** DouyinBarrageGrab å…³é—­åæµè§ˆå™¨æ— æ³•ä¸Šç½‘

**è§£å†³æ–¹æ³•ï¼š**
1. âœ… æ‰‹åŠ¨å…³é—­ç³»ç»Ÿä»£ç†ï¼š
   ```
   è®¾ç½® â†’ ç½‘ç»œå’ŒInternet â†’ ä»£ç† â†’ å…³é—­"ä½¿ç”¨ä»£ç†æœåŠ¡å™¨"
   ```

2. âœ… æˆ–è¿è¡Œ DouyinBarrageGrab ç›®å½•ä¸‹çš„ï¼š
   ```bash
   å…³é—­ä»£ç†.bat
   ```

### é—®é¢˜ 6: æ—¥å¿—æ˜¾ç¤º "æ— æ•ˆçš„JSONæ ¼å¼"

**ç—‡çŠ¶ï¼š** æ—¥å¿—ä¸­é¢‘ç¹å‡ºç° JSON è§£æé”™è¯¯

**å¯èƒ½åŸå› ï¼š**
- DouyinBarrageGrab ç‰ˆæœ¬ä¸å½“å‰ä»£ç ä¸å…¼å®¹
- æ¶ˆæ¯æ ¼å¼å‘ç”Ÿå˜åŒ–

**è§£å†³æ–¹æ³•ï¼š**
1. âœ… æ›´æ–°åˆ°æœ€æ–°ç‰ˆ DouyinBarrageGrab
2. âœ… æŸ¥çœ‹æ—¥å¿—ä¸­çš„åŸå§‹æ¶ˆæ¯å†…å®¹
3. âœ… åœ¨ GitHub/Gitee æäº¤ Issue åé¦ˆ

---

## âš™ï¸ è¿›é˜¶é…ç½®

### 1. å¤šç›´æ’­é—´ç›‘å¬

DouyinBarrageGrab å¯ä»¥åŒæ—¶ç›‘å¬å¤šä¸ªç›´æ’­é—´ï¼š

```xml
<!-- DouyinBarrageGrab config -->
<add key="webRoomIds" value="" />  <!-- ç•™ç©ºç›‘å¬æ‰€æœ‰ç›´æ’­é—´ -->
```

xiaozhi-server ä¼šæ¥æ”¶æ‰€æœ‰ç›´æ’­é—´çš„å¼¹å¹•ï¼Œå¯ä»¥é€šè¿‡ `room_info` å­—æ®µåŒºåˆ†æ¥æºã€‚

### 2. å¼¹å¹•æ¶ˆæ¯è¿‡æ»¤

**åœ¨ DouyinBarrageGrab ç«¯è¿‡æ»¤ï¼š**
```xml
<!-- åªæ¨é€å¼¹å¹•å’Œç¤¼ç‰©æ¶ˆæ¯ -->
<add key="pushFilter" value="1,5" />
<!-- 1=å¼¹å¹•ï¼Œ5=ç¤¼ç‰© -->
```

**åœ¨ xiaozhi-server ç«¯è¿‡æ»¤ï¼š**
ç¼–è¾‘ `danmaku_server/danmaku_handler.py`ï¼š
```python
async def _process_danmaku(self, danmaku: dict):
    content = danmaku.get('content', '')

    # è¿‡æ»¤çŸ­å¼¹å¹•
    if len(content) < 3:
        return

    # è¿‡æ»¤æ•æ„Ÿè¯
    sensitive_words = ['å¹¿å‘Š', 'åˆ·é‡']
    if any(word in content for word in sensitive_words):
        return

    # ç»§ç»­å¤„ç†...
```

### 3. ä½¿ç”¨æµè§ˆå™¨ä»£ç†æ‰©å±•ï¼ˆé¿å…ç³»ç»Ÿä»£ç†ï¼‰

å¦‚æœä¸æƒ³ä½¿ç”¨ç³»ç»Ÿä»£ç†ï¼Œå¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰©å±•ï¼š

**Edge/Chrome å®‰è£… SwitchyOmegaï¼š**
1. å®‰è£…æ‰©å±•ï¼šhttps://microsoftedge.microsoft.com/addons
2. æ·»åŠ ä»£ç†é…ç½®ï¼š
   - åè®®ï¼šHTTP
   - åœ°å€ï¼š127.0.0.1
   - ç«¯å£ï¼š8827 (DouyinBarrageGrab ä»£ç†ç«¯å£)
3. è¿›å…¥ç›´æ’­é¡µé¢æ—¶å¯ç”¨è¯¥ä»£ç†

**DouyinBarrageGrab é…ç½®ï¼š**
```xml
<!-- å…³é—­ç³»ç»Ÿä»£ç† -->
<add key="sysProxy" value="false" />
```

### 4. ä½¿ç”¨ç›´æ’­ä¼´ä¾£ï¼ˆæ— éœ€ç³»ç»Ÿä»£ç†ï¼‰

DouyinBarrageGrab æ”¯æŒç›‘å¬ç›´æ’­ä¼´ä¾£çš„å¼¹å¹•ï¼š

```xml
<add key="useproxy" value="false" />
<add key="liveCompanHookSwitch" value="true" />
```

è¯¦è§ï¼šDouyinBarrageGrab README.md "å®è·µæŒ‡å—"éƒ¨åˆ†

### 5. å¯ç”¨å¼¹å¹•æ—¥å¿—è®°å½•

**DouyinBarrageGrab ç«¯ï¼š**
```xml
<add key="barrageFileLog" value="true" />
<add key="logFilter" value="1,2,4,5,6,7,8" />
```
æ—¥å¿—ä¿å­˜åœ¨ï¼š`logs/å¼¹å¹•æ—¥å¿—/` ç›®å½•

**xiaozhi-server ç«¯ï¼š**
æ—¥å¿—è‡ªåŠ¨ä¿å­˜åœ¨ï¼š`tmp/danmaku_server.log`

### 6. å±€åŸŸç½‘éƒ¨ç½²

å¦‚æœ DouyinBarrageGrab å’Œ xiaozhi-server åœ¨ä¸åŒæœºå™¨ä¸Šï¼š

**DouyinBarrageGrab é…ç½®ï¼š**
```xml
<!-- ç›‘å¬æ‰€æœ‰IP -->
<add key="listenAny" value="true" />
```

**xiaozhi-server é…ç½®ï¼š**
```yaml
danmaku:
  proxy_ws_url: "ws://192.168.1.100:8888"  # DouyinBarrageGrab æ‰€åœ¨æœºå™¨çš„IP
```

---

## ğŸ“Š æ¶ˆæ¯æ ¼å¼å‚è€ƒ

### DouyinBarrageGrab æ¨é€çš„æ¶ˆæ¯æ ¼å¼

```json
{
  "Type": 1,  // æ¶ˆæ¯ç±»å‹ï¼š1=å¼¹å¹•ï¼Œ2=ç‚¹èµï¼Œ3=è¿›å…¥ï¼Œ4=å…³æ³¨ï¼Œ5=ç¤¼ç‰©ï¼Œ6=ç»Ÿè®¡ï¼Œ7=ç²‰ä¸å›¢ï¼Œ8=åˆ†äº«ï¼Œ9=ä¸‹æ’­
  "Data": "{...}"  // JSONå­—ç¬¦ä¸²ï¼ŒåŒ…å«å…·ä½“æ•°æ®
}
```

### å¼¹å¹•æ¶ˆæ¯ (Type=1) çš„ Data ç»“æ„

```json
{
  "MsgId": 123456,
  "Content": "ä½ å¥½ä¸»æ’­",
  "RoomId": "7123456789",
  "WebRoomId": "608120546494",
  "User": {
    "Id": 123,
    "Nickname": "è§‚ä¼—A",
    "Gender": 1,  // 0=æœªçŸ¥ï¼Œ1=ç”·ï¼Œ2=å¥³
    "Level": 10,
    "SecUid": "MS4wLjA..."
  },
  "Owner": {
    "UserId": "456",
    "Nickname": "ä¸»æ’­æ˜µç§°",
    "SecUid": "MS4wLjA..."
  }
}
```

### xiaozhi-server å›è°ƒå‡½æ•°æ”¶åˆ°çš„æ ¼å¼

```python
{
    'type': 'danmaku',
    'username': 'è§‚ä¼—A',
    'content': 'ä½ å¥½ä¸»æ’­',
    'timestamp': 0,
    'gender': 1,
    'gender_str': 'ç”·',
    'user_info': {...},  # å®Œæ•´ç”¨æˆ·ä¿¡æ¯
    'room_info': {...},  # å®Œæ•´ä¸»æ’­ä¿¡æ¯
    'raw_data': {...}    # åŸå§‹æ¶ˆæ¯æ•°æ®
}
```

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **DouyinBarrageGrab é¡¹ç›®**
  - Gitee: https://gitee.com/haodong108/dy-barrage-grab
  - GitHub: https://github.com/haodong108/dy-barrage-grab

- **xiaozhi-esp32-server é¡¹ç›®**
  - GitHub: https://github.com/xinnan-tech/xiaozhi-esp32-server

- **æŠ€æœ¯æ”¯æŒ**
  - DouyinBarrageGrab QQç¾¤ï¼š819927029 / 789875441
  - æäº¤ Issue åé¦ˆé—®é¢˜

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¿…é¡»ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ DouyinBarrageGrab**
2. **å¯åŠ¨é¡ºåºå¾ˆé‡è¦**ï¼šå…ˆå¯åŠ¨ DouyinBarrageGrabï¼Œå†æ‰“å¼€ç›´æ’­é—´
3. **DouyinBarrageGrab åªèƒ½ç›‘å¬æ¡æ‰‹ä¹‹åçš„å¼¹å¹•**
4. **å…³é—­ç¨‹åºåè®°å¾—å…³é—­ç³»ç»Ÿä»£ç†**ï¼ˆæˆ–ä½¿ç”¨ `å…³é—­ä»£ç†.bat`ï¼‰
5. **ä»…ç”¨äºå­¦ä¹ å’Œä¸ªäººä½¿ç”¨**ï¼Œä¸å¾—ç”¨äºå•†ä¸šç”¨é€”
6. **ä¸å¾—ç”¨äºæ¶æ„é‡‡é›†ä»–äººç›´æ’­é—´æ•°æ®**

---

## ğŸ“ ç‰ˆæœ¬å†å²

- **v1.0** (2025-01-16)
  - é¦–æ¬¡å‘å¸ƒ
  - é›†æˆ DouyinBarrageGrab ä»£ç†æ¨¡å¼
  - æ”¯æŒå®Œæ•´çš„å¼¹å¹•æ¶ˆæ¯è§£æ

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æºã€‚

DouyinBarrageGrab é¡¹ç›®è¯·éµå®ˆå…¶åŸé¡¹ç›®è®¸å¯è¯ã€‚

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ[æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)éƒ¨åˆ†ï¼Œæˆ–åœ¨é¡¹ç›® Issues ä¸­åé¦ˆã€‚
